name: Concurrency with workflow.
run-name: Triggered by ${{github.actor}} - ${{github.run_id}}.
on:
  workflow_dispatch:
    inputs:
      name:
        description: Pass your name.
        required: true
        type: string
        default: world
#concurrency: concurrency-group

jobs:
  hello:
    runs-on: ubuntu-latest
    env:
      cache-dir: cache-data
      cache-file: prev-val
      cache-key: concurrency-cachev
    steps:
      - name: Restore data from cache.
        id: restore-cache
        uses: actions/cache@v3
        with:
          path: ${{env.cache-dir}}
          key: ${{env.cache-key}}
      - name: Create directory if not exists.
        if: steps.restore-cache.outputs.cache-hit != 'true'
        run: mkdir ${{env.cache-dir}}
      - name: Print previous value.
        if: steps.restore-cache.outputs.cache-hit == 'true'
        run: |
          echo 'Cache contents:'
          echo $(ls -a ${{env.cache-dir}})
          export PREVIOUS_VALUE=$(cat ${{env.cache-dir}}/${{env.cache-file}})
          echo "Previous value was - ${PREVIOUS_VALUE}."
      - name: Processing data ...
        run: sleep 10
      - name: Print name.
        run: echo Hello ${{inputs.name}}!!!
      - name: Update cache.
        run: echo ${{inputs.name}} > ${{env.cache-dir}}/${{env.cache-file}}
      - name: Save cache.
        id: save-cache.
        uses: actions/cache/save@v3
        with:
          path: ${{env.cache-dir}}
          key: ${{env.cache-key}}
